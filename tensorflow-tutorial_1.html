<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="åˆæ¬¡å­¸ç¿’Tensorflowæœ€å›°é›£çš„åœ°æ–¹è«éæ–¼ä¸çŸ¥é“å¾ä½•ä¸‹æ‰‹ï¼Œå·²ç¶“å­¸æœƒå¾ˆå¤šçš„Deep Learningç†è«–ï¼Œä½†æ˜¯è¦è‡ªå·±ä½¿ç”¨Tensorflowå°‡Networkå»ºèµ·ä¾†å»æ˜¯éå¸¸å›°é›£çš„ï¼Œé€™ç¯‡æ–‡ç« æˆ‘æœƒå…ˆç°¡å–®çš„ä»‹ç´¹å¹¾å€‹Tensorflowçš„æ¦‚å¿µï¼Œæœ€å¾Œåˆ©ç”¨é€™äº›æ¦‚å¿µå»ºç«‹ä¸€å€‹ç°¡å–®çš„åˆ†é¡æ¨¡å‹ã€‚ æœ¬å–®å…ƒç¨‹å¼ç¢¼å¯æ–¼Githubä¸‹è¼‰ã€‚ MNIST Dataset...">
        <meta name="keywords" content="Tensorflow">
        <link rel="icon" href="./static/img/favicon.png">

        <title>å¯¦ä½œTensorflow (1)ï¼šSimple Logistic Classification on MNIST - YC Note</title>

        <!-- Stylesheets -->
        <link href="./theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="YCNote/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="YC Note Full Atom Feed" />
        <link href="YCNote/feeds/aiml.atom.xml" type="application/atom+xml" rel="alternate" title="YC Note Categories Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('./images/tensorflow-logo.jpg'); background-position: center; background-size: cover;">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="./"><img class="logo" src="./static/img/favicon.png" alt="logo">YC Note</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="./category/coding.html">Coding</a>
                                <a href="./category/aiml.html">AI.ML</a>
                                <a href="./category/reading.html">Reading</a>
                                <a href="./category/recording.html">Recording</a>
                                <a href="./about-me.html">About Me</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">å¯¦ä½œTensorflow (1)ï¼šSimple Logistic Classification on MNIST</h1>
                      <p class="header-date">By <a href="./author/yc-chen.html">YC Chen</a>, 2017 / 10æœˆ 23, in category <a href="./category/aiml.html">Ai.ml</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="./tag/tensorflow.html">Tensorflow</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>åˆæ¬¡å­¸ç¿’Tensorflowæœ€å›°é›£çš„åœ°æ–¹è«éæ–¼ä¸çŸ¥é“å¾ä½•ä¸‹æ‰‹ï¼Œå·²ç¶“å­¸æœƒå¾ˆå¤šçš„Deep Learningç†è«–ï¼Œä½†æ˜¯è¦è‡ªå·±ä½¿ç”¨Tensorflowå°‡Networkå»ºèµ·ä¾†å»æ˜¯éå¸¸å›°é›£çš„ï¼Œé€™ç¯‡æ–‡ç« æˆ‘æœƒå…ˆç°¡å–®çš„ä»‹ç´¹å¹¾å€‹Tensorflowçš„æ¦‚å¿µï¼Œæœ€å¾Œåˆ©ç”¨é€™äº›æ¦‚å¿µå»ºç«‹ä¸€å€‹ç°¡å–®çš„åˆ†é¡æ¨¡å‹ã€‚</p>
<p>æœ¬å–®å…ƒç¨‹å¼ç¢¼å¯æ–¼<a href="https://github.com/GitYCC/Tensorflow_Tutorial/blob/master/code/01_simple_logistic_classification_on_MNIST.py">Github</a>ä¸‹è¼‰ã€‚</p>
<h3>MNIST Dataset</h3>
<p>é¦–å…ˆï¼Œå…ˆ<code>import</code>ä¸€äº›æœƒç”¨åˆ°çš„functionï¼Œä¸¦ä¸”å®šç¾©<code>summary</code> functionä»¥ä¾¿æ–¼è§€å¯Ÿndarrayã€‚</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># Config the matplotlib backend as plotting inline in IPython</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="n">ndarr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* shape: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ndarr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* min: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* max: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* avg: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* std: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* unique: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ndarr</span><span class="p">)))</span>
</pre></div>


<p>ndarrayæ˜¯numpyçš„åŸºæœ¬å…ƒç´ ï¼Œå®ƒéå¸¸ä¾¿æ–¼æˆ‘å€‘åšçŸ©é™£çš„é‹ç®—ã€‚</p>
<p>æˆ‘å€‘ä½¿ç”¨MNIST Datasetä¾†ç•¶ä½œæˆ‘å€‘ç·´ç¿’çš„æ¨™çš„ï¼ŒMNISTåŒ…å«ä¸€åŒ…æ‰‹å¯«æ•¸å­—çš„åœ–ç‰‡ï¼Œæ¯å¼µåœ–ç‰‡å¤§å°ç‚º28x28ï¼Œæ¯ä¸€å¼µåœ–ç‰‡éƒ½æ˜¯ä¸€å€‹æ‰‹å¯«çš„é˜¿æ‹‰ä¼¯æ•¸å­—åŒ…å«0åˆ°9ï¼Œä¸¦ä¸”æ¨™è¨˜ä¸Šå®ƒæ‰€å°æ‡‰çš„æ•¸å­—ã€‚æˆ‘å€‘çš„ç›®æ¨™å°±æ˜¯è¦åˆ©ç”¨MNISTåšåˆ°æ‰‹å¯«æ•¸å­—è¾¨è­˜ã€‚</p>
<p>åœ¨Tensorflowä½ å¯ä»¥å¾ˆç°¡å–®çš„å¾—åˆ°ã€Œè™•ç†éå¾Œçš„ã€MNISTï¼Œåªè¦åˆ©ç”¨ä»¥ä¸‹ç¨‹å¼ç¢¼ï¼Œ</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="kn">import</span> <span class="n">input_data</span>
<span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s2">&quot;MNIST_data/&quot;</span><span class="p">,</span> <span class="n">one_hot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">train_data</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">train</span>
<span class="n">valid_data</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">validation</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">test</span>
</pre></div>


<div class="highlight"><pre><span></span>Extracting MNIST_data/train-images-idx3-ubyte.gz
Extracting MNIST_data/train-labels-idx1-ubyte.gz
Extracting MNIST_data/t10k-images-idx3-ubyte.gz
Extracting MNIST_data/t10k-labels-idx1-ubyte.gz
</pre></div>


<p>æ¯å€‹<code>train_data</code>ã€<code>valid_data</code>ã€<code>test_data</code>éƒ½åŒ…å«å…©éƒ¨åˆ†ï¼šåœ–ç‰‡å’Œæ¨™ç±¤ã€‚</p>
<p>æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹åœ–ç‰‡çš„éƒ¨åˆ†ï¼Œ<code>train_data.images</code>ä¸€å…±æœ‰55000å¼µåœ–ï¼Œæ¯ä¸€å¼µåœ–åŸæœ¬å¤§å°æ˜¯28x28ï¼Œä¸éç‰¹åˆ¥æ³¨æ„é€™è£¡çš„Dataå·²ç¶“å…ˆåšéé å…ˆè™•ç†äº†ï¼Œå› æ­¤åœ–ç‰‡å·²ç¶“è¢«æ‰“å¹³æˆ28x28=784çš„ä¸€ç¶­çŸ©é™£äº†ï¼Œå¦å¤–æ¯å€‹Pixelçš„å€¼ä¹Ÿå…ˆåšéã€ŒNormalizationã€äº†ï¼Œé€šå¸¸æœƒé€™æ¨£è™•ç†ï¼Œæ¯å€‹å€¼æ¸›å»128å†é™¤ä»¥128ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¾ä»¥ä¸‹çš„<code>summary</code>ä¸­çœ‹åˆ°å®ƒçš„æœ€å¤§æœ€å°å€¼è½åœ¨0åˆ°1ä¹‹é–“ï¼Œé‚„æœ‰é€™å€‹Datasetä¹Ÿå·²ç¶“åšéäº‚æ•¸é‡æ’äº†ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="na">..., </span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]]</span>
<span class="na">* shape: (55000, 784)</span>
<span class="na">* min: 0.0</span>
<span class="na">* max: 1.0</span>
<span class="na">* avg: 0.13070042431354523</span>
<span class="na">* std: 0.30815958976745605</span>
<span class="na">* unique: [ 0.          0.00392157  0.00784314  0.01176471  0.01568628  0.01960784</span>
  <span class="na">0.02352941  0.02745098  0.03137255  0.03529412  0.03921569  0.04313726</span>
  <span class="na">0.04705883  0.0509804   0.05490196  0.05882353  0.0627451   0.06666667</span>
  <span class="na">0.07058824  0.07450981  0.07843138  0.08235294  0.08627451  0.09019608</span>
  <span class="na">0.09411766  0.09803922  0.10196079  0.10588236  0.10980393  0.1137255</span>
  <span class="na">0.11764707  0.12156864  0.1254902   0.12941177  0.13333334  0.13725491</span>
  <span class="na">0.14117648  0.14509805  0.14901961  0.15294118  0.15686275  0.16078432</span>
  <span class="na">0.16470589  0.16862746  0.17254902  0.17647059  0.18039216  0.18431373</span>
  <span class="na">0.18823531  0.19215688  0.19607845  0.20000002  0.20392159  0.20784315</span>
  <span class="na">0.21176472  0.21568629  0.21960786  0.22352943  0.227451    0.23137257</span>
  <span class="na">0.23529413  0.2392157   0.24313727  0.24705884  0.25098041  0.25490198</span>
  <span class="na">0.25882354  0.26274511  0.26666668  0.27058825  0.27450982  0.27843139</span>
  <span class="na">0.28235295  0.28627452  0.29019609  0.29411766  0.29803923  0.3019608</span>
  <span class="na">0.30588236  0.30980393  0.3137255   0.31764707  0.32156864  0.32549021</span>
  <span class="na">0.32941177  0.33333334  0.33725491  0.34117648  0.34509805  0.34901962</span>
  <span class="na">0.35294119  0.35686275  0.36078432  0.36470589  0.36862746  0.37254903</span>
  <span class="na">0.37647063  0.38039219  0.38431376  0.38823533  0.3921569   0.39607847</span>
  <span class="na">0.40000004  0.4039216   0.40784317  0.41176474  0.41568631  0.41960788</span>
  <span class="na">0.42352945  0.42745101  0.43137258  0.43529415  0.43921572  0.44313729</span>
  <span class="na">0.44705886  0.45098042  0.45490199  0.45882356  0.46274513  0.4666667</span>
  <span class="na">0.47058827  0.47450984  0.4784314   0.48235297  0.48627454  0.49019611</span>
  <span class="na">0.49411768  0.49803925  0.50196081  0.50588238  0.50980395  0.51372552</span>
  <span class="na">0.51764709  0.52156866  0.52549022  0.52941179  0.53333336  0.53725493</span>
  <span class="na">0.5411765   0.54509807  0.54901963  0.5529412   0.55686277  0.56078434</span>
  <span class="na">0.56470591  0.56862748  0.57254905  0.57647061  0.58039218  0.58431375</span>
  <span class="na">0.58823532  0.59215689  0.59607846  0.60000002  0.60392159  0.60784316</span>
  <span class="na">0.61176473  0.6156863   0.61960787  0.62352943  0.627451    0.63137257</span>
  <span class="na">0.63529414  0.63921571  0.64313728  0.64705884  0.65098041  0.65490198</span>
  <span class="na">0.65882355  0.66274512  0.66666669  0.67058825  0.67450982  0.67843139</span>
  <span class="na">0.68235296  0.68627453  0.6901961   0.69411767  0.69803923  0.7019608</span>
  <span class="na">0.70588237  0.70980394  0.71372551  0.71764708  0.72156864  0.72549021</span>
  <span class="na">0.72941178  0.73333335  0.73725492  0.74117649  0.74509805  0.74901962</span>
  <span class="na">0.75294125  0.75686282  0.76078439  0.76470596  0.76862752  0.77254909</span>
  <span class="na">0.77647066  0.78039223  0.7843138   0.78823537  0.79215693  0.7960785</span>
  <span class="na">0.80000007  0.80392164  0.80784321  0.81176478  0.81568635  0.81960791</span>
  <span class="na">0.82352948  0.82745105  0.83137262  0.83529419  0.83921576  0.84313732</span>
  <span class="na">0.84705889  0.85098046  0.85490203  0.8588236   0.86274517  0.86666673</span>
  <span class="na">0.8705883   0.87450987  0.87843144  0.88235301  0.88627458  0.89019614</span>
  <span class="na">0.89411771  0.89803928  0.90196085  0.90588242  0.90980399  0.91372555</span>
  <span class="na">0.91764712  0.92156869  0.92549026  0.92941183  0.9333334   0.93725497</span>
  <span class="na">0.94117653  0.9450981   0.94901967  0.95294124  0.95686281  0.96078438</span>
  <span class="na">0.96470594  0.96862751  0.97254908  0.97647065  0.98039222  0.98431379</span>
  <span class="na">0.98823535  0.99215692  0.99607849  1.        ]</span>
</pre></div>


<p>ä¾†è©¦è‘—ç•«åœ–ä¾†çœ‹çœ‹ï¼Œæˆ‘å€‘ä½¿ç”¨ndarrayçš„indexåŠŸèƒ½ä¾†é¸å‡ºç¬¬10å¼µåœ–ç‰‡ï¼Œ<code>train_data.images[10,:]</code>è¡¨ç¤ºçš„æ˜¯é¸ç¬¬ä¸€è»¸çš„ç¬¬10å€‹å’Œç¬¬äºŒè»¸çš„å…¨éƒ¨ã€‚</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_fatten_img</span><span class="p">(</span><span class="n">ndarr</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">ndarr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">img</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">plot_fatten_img</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">10</span><span class="p">,:])</span>
</pre></div>


<p><img alt="png" src="output_8_0.png"></p>
<p>å¾ˆé¡¯è€Œæ˜“è¦‹çš„ï¼Œé€™æ˜¯ä¸€å€‹0ã€‚</p>
<p>æ¥ä¸‹ä¾†ä¾†çœ‹æ¨™ç±¤çš„éƒ¨åˆ†ï¼Œ<code>train_data.labels</code>ä¸æ„å¤–çš„ä¸€æ¨£çš„ä¹Ÿæ˜¯æœ‰ç›¸æ‡‰çš„55000ç­†è³‡æ–™ï¼Œæ‰€å°æ‡‰çš„å°±æ˜¯å‰é¢çš„æ¯ä¸€å¼µåœ–ç‰‡ï¼Œç¸½å…±æœ‰10ç¨®é¡å‹:0åˆ°9ï¼Œæ‰€ä»¥å¤§å°ç‚º(55000, 10)ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">summary</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[[ 0.  0.  0. ...,  1.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="na">..., </span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  0.  0.]</span>
 <span class="k">[ 0.  0.  0. ...,  0.  1.  0.]]</span>
<span class="na">* shape: (55000, 10)</span>
<span class="na">* min: 0.0</span>
<span class="na">* max: 1.0</span>
<span class="na">* avg: 0.1</span>
<span class="na">* std: 0.30000000000000004</span>
<span class="na">* unique: [ 0.  1.]</span>
</pre></div>


<p>æ‰€ä»¥æˆ‘å€‘ä¾†çœ‹çœ‹ä¸Šé¢é‚£å¼µåœ–ç‰‡çš„æ¨™ç±¤ï¼Œ</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span>[ 1.  0.  0.  0.  0.  0.  0.  0.  0.  0.]
</pre></div>


<p>çœ‹èµ·ä¾†çš„ç¢ºæ²’éŒ¯ï¼Œåœ¨0çš„ä½ç½®æ¨™ç¤º1.ï¼Œè€Œå…¶ä»–åœ°æ–¹æ¨™ç¤ºç‚º0.ï¼Œå› æ­¤é€™æ˜¯ä¸€å€‹æ¨™ç¤ºç‚º0çš„labelæ²’æœ‰éŒ¯ï¼Œé€™ç¨®è¡¨ç¤ºæ–¹æ³•ç¨±ç‚ºOne-Hot Encodingï¼Œå®ƒå…·æœ‰æ©Ÿç‡çš„æ¶µç¾©ï¼Œæ‰€ä»£è¡¨çš„æ˜¯æœ‰100%çš„æ©Ÿæœƒè½åœ¨0çš„é¡åˆ¥ä¸Šã€‚</p>
<h3>Softmax</h3>
<p>é€šå¸¸One-Hot Encodingæœƒæ­é…Softmaxä¸€åŒæœç”¨ï¼Œæœ€å¾Œçš„Outputçµæœå¦‚æœæ˜¯æ©Ÿç‡åˆ†å¸ƒï¼Œé‚£æˆ‘ä¹Ÿéœ€è¦è®“æˆ‘çš„Neurel Networkå¯ä»¥è¼¸å‡ºæ©Ÿç‡åˆ†å¸ƒã€‚</p>
<p><img alt="softmax" src="https://raw.githubusercontent.com/GitYCC/Tensorflow_Tutorial/master/img/TensorflowTutorial.001.jpeg"></p>
<p>é€šéSoftmaxé€™ä¸€å±¤ï¼Œæˆ‘å€‘å°±å¯ä»¥å°‡è¼¸å‡ºè½‰è®Šç‚ºä»¥ã€Œæ©Ÿç‡ã€è¡¨ç¤ºã€‚</p>
<p>æˆ‘å€‘å¯ä»¥ä¾†æ‰‹åˆ»ä¸€å€‹Softmax Functionï¼Œä¸éç›´æ¥å¥—ç”¨Tensorflowä¸­å‡½æ•¸çš„ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># avoid exp function go to too large,</span>
    <span class="c1"># pre-reduce before applying exp function</span>
    <span class="n">max_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">max_score</span>

    <span class="n">exp_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">sum_exp_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_s</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">softmax</span> <span class="o">=</span> <span class="n">exp_s</span> <span class="o">/</span> <span class="n">sum_exp_s</span>
    <span class="k">return</span> <span class="n">softmax</span>

<span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">softmax</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>[ 0.8360188   0.11314284  0.05083836]
</pre></div>


<h3>Cross-Entropy Loss</h3>
<p>ä¸€æ—¦æˆ‘å€‘è¦è™•ç†æ©Ÿç‡é æ¸¬çš„å•é¡Œï¼Œå°±ä¸å¯ä»¥ä½¿ç”¨å–®ç´”çš„ã€Œå¹³æ–¹èª¤å·®ã€ï¼Œè€Œå¿…é ˆä½¿ç”¨Cross-Entropy Lossï¼Œæ˜¯é€™æ¨£è¨ˆç®—çš„ï¼š</p>
<p>Cross-Entropy Loss = -ğšº<sub>i</sub> y<sub>i</sub> ln[ s<sub>i</sub> ]</p>
<p>å…¶ä¸­ï¼Œy<sub>i</sub>ç‚ºç›®æ¨™Labelï¼Œs<sub>i</sub>ç‚ºç¶“éSoftmaxç”¢ç”Ÿçš„é æ¸¬å€¼ã€‚</p>
<p>è‡³æ–¼å¦‚æœä½ æƒ³è¦äº†è§£ç‚ºä½•éœ€è¦ä½¿ç”¨Cross-Entropy Lossï¼Ÿé€™æˆ‘åœ¨æ©Ÿå™¨å­¸ç¿’åŸºçŸ³çš„ç­†è¨˜ä¸­å·²ç¶“æœ‰æåŠéï¼Œè«‹çœ‹<a href="http://www.ycc.idv.tw/YCNote/post/27">ä»‹ç´¹Logistic Regressionçš„éƒ¨åˆ†</a>ã€‚</p>
<h3>åˆ†é›¢æ•¸æ“šçš„é‡è¦æ€§</h3>
<p>åœ¨MNIST Datasetä¸­ï¼Œä½ æœƒç™¼ç¾åˆ†ç‚ºTraining Datasetã€Validation Datasetå’ŒTesting Datasetï¼Œé€™æ¨£çš„ä½œæ³•åœ¨Machine Learningä¸­æ˜¯å¸¸è¦‹ä¸”å¿…è¦çš„ã€‚</p>
<p>æµç¨‹æ˜¯é€™æ¨£çš„ï¼Œæˆ‘å€‘æœƒå…ˆä½¿ç”¨Training Datasetä¾†è¨“ç·´Modelï¼Œä¸¦ä¸”ä½¿ç”¨Validation Datasetä¾†æª¢é©—Modelçš„å¥½å£ï¼Œæˆ‘å€‘æœƒä¾æ“šValidation Datasetçš„æª¢é©—èª¿æ•´Modelä¸Šçš„åƒæ•¸ï¼Œè©¦è‘—ç›¡å¯èƒ½çš„å£“ä½Validation Datasetçš„Errorï¼Œè¨˜ä½ï¼åœ¨éç¨‹ä¸­æ‰€ç”¢ç”Ÿçš„æ‰€æœ‰Modelséƒ½è¦ä¿ç•™ä¸‹ä¾†ï¼Œå› ç‚ºæœ€å¾Œé¸æ“‡çš„Modelä¸¦ä¸æ˜¯Validation Datasetçš„Erroræœ€å°çš„ï¼Œè€Œæ˜¯è¦å†ç”±Testing Datasetä¾†åšæœ€å¾Œçš„æŒ‘é¸ï¼ŒæŒ‘é¸å‡ºèƒ½ä½¿Testing Datasetçš„Erroræœ€å°çš„Modelã€‚</p>
<p>é€™æ‰€æœ‰çš„ä½œæ³•éƒ½æ˜¯ç‚ºäº†é¿å…Overfittingçš„æƒ…æ³ç™¼ç”Ÿï¼Œä¹Ÿå°±æ˜¯æ©Ÿå™¨å¯èƒ½å› ç‚ºçœ‹éä¸€ç­†Dataï¼Œçµæœå°±æŠŠé€™ç­†Dataçµ¦å®Œæ•´è¨˜äº†èµ·ä¾†ï¼Œè€ŒDataæœ¬èº«å«æœ‰é›œè¨Šï¼Œé›œè¨Šå°±é€™æ¨£æ»²é€åˆ°Modelè£¡ï¼Œç¢ºå¯¦åšåˆ°åˆ†é›¢æ˜¯å¾ˆé‡è¦çš„ï¼Œè®“Modelåœ¨æ¸¬è©¦éšæ®µæ™‚å¯ä»¥ä½¿ç”¨æ²’æœ‰çœ‹éçš„Dataã€‚</p>
<p>å› æ­¤ï¼ŒValidation Datasetçš„åˆ†é›¢æ˜¯ç‚ºäº†é¿å…è®“Modelåœ¨Trainingéšæ®µçœ‹åˆ°è¦é©—è­‰çš„è³‡æ–™ï¼Œæ‰€ä»¥æ›´èƒ½æ­£ç¢ºçš„è©•ä¼°Modelçš„å¥½å£ã€‚ä½†é€™æ¨£æ˜¯ä¸å¤ çš„ï¼Œäººç‚ºæœƒæ ¹æ“šValidation Datasetä¾†èª¿æ•´Modelï¼Œé€™æ¨£ç„¡å½¢ä¹‹ä¸­å·²ç¶“å°‡Validation Datasetçš„è³‡è¨Šé–“æ¥çš„ç¶“ç”±äººå‚³çµ¦äº†Modelï¼Œæ‰€ä»¥é‚„æ˜¯æ²’æœ‰å¾¹åº•åˆ†é›¢ï¼Œå› æ­¤åœ¨æœ€å¾ŒæŒ‘é¸Modelsæ™‚ï¼Œæˆ‘å€‘æœƒä½¿ç”¨å¦å¤–ä¸€ç­†å¾æ²’çœ‹éçš„è³‡æ–™Testing Datasetä¾†åšæŒ‘é¸ï¼Œä¸€æ—¦æŒ‘é¸å®Œå°±ä¸èƒ½å†å»èª¿æ•´ä»»ä½•åƒæ•¸äº†ã€‚</p>
<h3>Tensorflowå·¥ä½œæµç¨‹</h3>
<p>æˆ‘å€‘é€™ä¸€ç¯‡å°‡æœƒä½¿ç”¨Tensorflowå¯¦ä½œæœ€ç°¡å–®çš„å–®å±¤Neurel Networkï¼Œåœ¨é€™ä¹‹å‰æˆ‘å€‘ä¾†çœ‹çœ‹Tensorflowæ˜¯å¦‚ä½•é‹ä½œçš„ï¼Ÿ</p>
<p>æ·±åº¦å­¸ç¿’æ˜¯ç”±ä¸€å±¤ä¸€å±¤å¯ä»¥å¾®åˆ†çš„ç¥ç¶“å…ƒæ‰€é€£æ¥è€Œæˆï¼Œæ•¸å­¸ä¸Šå¯ä»¥è¡¨ç¤ºç‚ºå¼µé‡(Tensor)çš„è¡¨ç¤ºå¼ï¼Œæˆ‘å€‘ä¸€èˆ¬è¬›çš„çŸ©é™£é‹ç®—æ˜¯æŒ‡2x2çš„çŸ©é™£é‹ç®—ï¼Œè€Œå¼µé‡(Tensor)å‰‡æ˜¯æ‹“å¯¬åˆ°nç¶­é™£åˆ—åšè¨ˆç®—ï¼Œåœ¨Machine Learningç•¶ä¸­æˆ‘å€‘å¸¸å¸¸éœ€è¦è™•ç†åˆ°ç›¸ç•¶é«˜ç¶­åº¦çš„è¨ˆç®—ï¼Œä¾‹å¦‚ï¼šæœ‰äº”å¼µ28x28çš„å½©è‰²åœ–çš„è¡¨ç¤ºå°±å¿…é ˆä½¿ç”¨åˆ°å››ç¶­å¼µé‡ï¼Œç¬¬ä¸€ç¶­è¡¨ç¤ºç¬¬å¹¾å¼µã€ç¬¬äºŒã€ä¸‰ç¶­è¡¨ç¤ºåœ–ç‰‡çš„å¤§å°ã€ç¬¬å››ç¶­å‰‡è¡¨ç¤ºRGBï¼Œå¦‚æœä½ æ˜¯ç‰©ç†ç³»çš„å­¸ç”Ÿæ‡‰è©²ä¹Ÿå°å¼µé‡ä¸é™Œç”Ÿï¼Œå»£ç¾©ç›¸å°è«–è£¡é ­å¤§é‡çš„ä½¿ç”¨å››ç¶­å¼µé‡é‹ç®—ï¼Œä¸‰ç¶­ç©ºé–“åŠ ä¸€ç¶­æ™‚é–“ã€‚</p>
<p>è€Œåœ¨åšNeurel Networkæ™‚ï¼Œæˆ‘å€‘æœƒæ ¹æ“šéœ€æ±‚ä¸åŒè¨­è¨ˆä¸åŒå½¢å¼ä½†åˆç†çš„æµç¨‹(Flow)ï¼Œå†ä½¿ç”¨æ•¸æ“šä¾†è¨“ç·´æˆ‘çš„Modelã€‚æ‰€ä»¥ï¼Œé€™å°±æ˜¯Tensorflowå‘½åç”±ä¾†ï¼šTensor+Flowã€‚</p>
<p>å› æ­¤ï¼Œä¸€é–‹å§‹è¦å…ˆè¨­è¨ˆModelçš„çµæ§‹ï¼Œé€™åœ¨Tensorflowè£¡é ­ç¨±ç‚ºGraphï¼ŒGraphçš„ä½œç”¨æ˜¯äº‹å…ˆæ±ºå®šNeurel Networkçš„çµæ§‹ï¼Œæ±ºå®šNeuronè¦æ€éº¼é€£æ¥ï¼Ÿæ±ºå®šå“ªä¸€äº›çª—å£æ˜¯å¯ä»¥ç”±å¤–éƒ¨ç½®æ”¾æ•¸æ“šçš„ï¼Ÿæ±ºå®šå“ªä¸€äº›è®Šæ•¸æ˜¯å¯ä»¥è¢«è¨“ç·´çš„ï¼Ÿå“ªä¸€äº›è®Šæ•¸æ˜¯ä¸å¯ä»¥è¢«è¨“ç·´çš„ï¼Ÿå®šç¾©å°‡è¦æ€éº¼æ¨£å„ªåŒ–é€™å€‹ç³»çµ±ï¼Ÿ...ç­‰ç­‰ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">my_graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span> <span class="c1"># Initialize a new graph</span>

<span class="k">with</span> <span class="n">my_graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span> <span class="c1"># Create a scope to build graph</span>
    <span class="c1"># ...</span>
    <span class="c1"># detail of building graph</span>
</pre></div>


<p>Graphåªæ˜¯ä¸€å€‹çµæ§‹ï¼Œå®ƒä¸å…·æœ‰æœ‰æ•ˆçš„è³‡è¨Šï¼Œè€Œç•¶æˆ‘å€‘å®šç¾©å®ŒæˆGraphä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘éœ€è¦å‰µé€ ä¸€å€‹ç’°å¢ƒå«åšSessionï¼ŒSessionæœƒå°‡Graphçš„çµæ§‹è¤‡è£½ä¸€ä»½ï¼Œç„¶å¾Œå†æ”¾å…¥è³‡è¨Šé€²è¡ŒTrainingæˆ–æ˜¯é æ¸¬ç­‰ç­‰ï¼Œå› æ­¤Sessionæ˜¯å…·æœ‰æœ‰æ•ˆè³‡è¨Šçš„ã€‚</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">my_graph</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span> <span class="c1"># Copy graph into session</span>
    <span class="c1"># ...</span>
    <span class="c1"># detail of doing machine learning  </span>
</pre></div>


<p>é‚„æœ‰å¦å¤–ä¸€ç¨®å¯«æ³•ä¹Ÿæ˜¯ç›¸åŒä½œç”¨çš„ï¼Œæˆ‘å€‹äººæ¯”è¼ƒå–œæ­¡ä¸‹é¢é€™ç¨®å¯«æ³•ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">my_session</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">my_graph</span><span class="p">)</span>
<span class="n">my_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>


<h3>Tensorflowçš„åŸºæœ¬ã€Œå¼µé‡ã€å…ƒç´ </h3>
<p>æ¥ä¸‹ä¾†æˆ‘å€‘å°±ä¾†çœ‹çœ‹æœ‰å“ªäº›æ§‹æˆGraphçš„åŸºæœ¬å…ƒç´ å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>(1) å¸¸æ•¸å¼µé‡ï¼š</p>
<p>ä¸€é–‹å§‹ä¾†çœ‹çœ‹ã€Œå¸¸æ•¸å¼µé‡ã€ï¼Œå¸¸æ•¸æŒ‡çš„æ˜¯åœ¨Modelä¸­ä¸æœƒæ”¹è®Šçš„æ•¸å€¼ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</pre></div>


<p>(2) è®Šæ•¸å¼µé‡ï¼š</p>
<p>èˆ‡å¸¸æ•¸æˆªç„¶ä¸åŒçš„å°±æ˜¯è®Šæ•¸ï¼Œã€Œè®Šæ•¸å¼µé‡ã€æ˜¯æŒ‡åœ¨è¨“ç·´ç•¶ä¸­å¯ä»¥æ”¹è®Šçš„å€¼ï¼Œä¸€èˆ¬ã€Œè®Šæ•¸å¼µé‡ã€æœƒç”¨ä½œæ–¼Machine Learningéœ€è¦è¢«è¨“ç·´çš„åƒæ•¸ï¼Œå¦‚æœä½ æ²’æœ‰ç‰¹åˆ¥è¨­å®šï¼Œåœ¨æœ€ä½³åŒ–çš„éç¨‹ä¸­ï¼ŒTensorflowæœƒè‡ªå‹•èª¿æ•´ã€Œè®Šæ•¸å¼µé‡ã€çš„æ•¸å€¼ä¾†æœ€ä½³åŒ–ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span> <span class="n">tf</span><span class="o">.</span><span class="n">truncated_normal</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="p">)</span>
</pre></div>


<p>å› ç‚ºè®Šæ•¸é€šå¸¸æ˜¯æœªçŸ¥ä¸”å¾…å„ªåŒ–çš„åƒæ•¸ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸€èˆ¬æœƒä½¿ç”¨Initalizerä¾†è¨­å®šå®ƒçš„åˆå§‹å€¼ï¼Œ<code>tf.truncated_normal(shape=(3,5))</code>æœƒéš¨æ©Ÿç”¢ç”Ÿå¤§å°3x5çš„çŸ©é™£ï¼Œå®ƒçš„å€¼å‘ˆå¸¸æ…‹åˆ†ä½ˆä½†åªå–å…©å€‹æ¨™æº–å·®ä»¥å…§çš„æ•¸å€¼ã€‚</p>
<p>å¦‚æœä»Šå¤©ä½ æƒ³è¦æœ‰ä¸€å€‹ã€Œè®Šæ•¸å¼µé‡ã€ä½†æ˜¯åˆä¸å¸Œæœ›å®ƒå› ç‚ºæœ€ä½³åŒ–è€Œæ”¹è®Šï¼Œé€™æ™‚ä½ è¦ç‰¹åˆ¥æŒ‡å®š<code>trainable</code>ç‚º<code>False</code>ã€‚</p>
<div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<p>(3) ç½®æ”¾å¼µé‡ï¼š</p>
<p>å¦å¤–æœ‰ä¸€äº›å¼µé‡è² è²¬æ“”ä»»è¼¸å…¥çª—å£çš„è§’è‰²ï¼Œç¨±ç‚ºPlaceholderã€‚</p>
<div class="highlight"><pre><span></span><span class="n">tensor</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
</pre></div>


<p>å› ç‚ºæˆ‘å€‘åœ¨è¨“ç·´ä¹‹å‰é‚„å°šæœªçŸ¥é“Dataçš„æ•¸é‡ï¼Œæ‰€ä»¥é€™è£¡ä½¿ç”¨Noneä¾†è¡¨ç¤ºæœªçŸ¥ã€‚<code>tf.placeholder</code>åœ¨Graphéšæ®µæ˜¯æ²’æœ‰æ•¸å€¼çš„ï¼Œå¿…é ˆç­‰åˆ°Sessionéšæ®µæ‰å°‡æ•¸å€¼çµ¦è¼¸å…¥é€²å»ã€‚</p>
<p>(4) æ“ä½œå‹å¼µé‡ï¼š</p>
<p>é€™é¡å¼µé‡ä¸¦ä¸å«æœ‰å¯¦éš›æ•¸å€¼ï¼Œè€Œæ˜¯ä¸€ç¨®æ“ä½œï¼Œå¸¸ç”¨çš„ã€Œæ“ä½œå‹å¼µé‡ã€æœ‰å…©ç¨®ï¼Œç¬¬ä¸€ç¨®æ˜¯ä½œç‚ºæœ€ä½³åŒ–ä½¿ç”¨ï¼Œ</p>
<div class="highlight"><pre><span></span><span class="n">loss</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</pre></div>


<p>é¸æ“‡Optimizerå’Œæœ€ä½³åŒ–çš„æ–¹å¼ä¾†å®šç¾©æœ€ä½³åŒ–çš„æ“ä½œæ–¹æ³•ï¼Œä¸Šè¿°çš„ä¾‹å­æ˜¯ä½¿ç”¨learning_rateç‚º0.5çš„Gradient Descentä¾†é™ä½lossã€‚</p>
<p>å¦å¤–ä¸€ç¨®æ˜¯åˆå§‹åŒ–çš„æ“ä½œï¼Œ</p>
<div class="highlight"><pre><span></span><span class="n">init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>
</pre></div>


<p>é€™ä¸€å€‹æ­¥é©Ÿæ˜¯å¿…è¦çš„ä½†å¸¸å¸¸è¢«å¿½ç•¥ï¼Œé‚„è¨˜å¾—å‰›å‰›æˆ‘å€‘å®šç¾©ã€Œè®Šæ•¸å¼µé‡ã€æ™‚æœ‰ç”¨åˆ°Initalizerï¼Œé€™äº›Initalizeråœ¨Graphå®Œæˆæ™‚é‚„ä¸å…·æœ‰æ•¸å€¼ï¼Œå¿…é ˆä½¿ç”¨<code>init_op</code>ä¾†çµ¦äºˆæ•¸å€¼ï¼Œæ‰€ä»¥è¨˜ä½ä¸€å®šè¦æ”¾<code>init_op</code>é€²å»Graphè£¡é ­ï¼Œè€Œä¸”å¿…é ˆå…ˆå®šç¾©å®Œæˆæ‰€æœ‰æœƒç”¨åˆ°çš„Initalizerå†ä¾†è¨­å®šé€™å€‹<code>init_op</code>ã€‚</p>
<h3>Sessionçš„æ“ä½œ</h3>
<p>ã€Œå¼µé‡ã€å…ƒç´ å…·æœ‰å…©å€‹é¢å‘ï¼šåŠŸèƒ½å’Œæ•¸å€¼ï¼Œåœ¨Graphéšæ®µã€Œå¼µé‡ã€åªå…·æœ‰åŠŸèƒ½ä½†ä¸å…·æœ‰æ•¸å€¼ï¼Œåªæœ‰åˆ°äº†Sessionéšæ®µæ‰é–‹å§‹æœ‰æ•¸å€¼ï¼Œé‚£å¦‚ä½•å°‡é€™äº›æ•¸å€¼å–å‡ºä¾†å‘¢ï¼Ÿæœ‰å…©ç¨®æ–¹æ³•ï¼Œä»¥1+1ç•¶ä½œç¯„ä¾‹ä¾†çœ‹çœ‹ï¼Œ</p>
<div class="highlight"><pre><span></span><span class="n">g1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">g1</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># add x and y</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g1</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span> 
    <span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span> <span class="c1"># print tensor, not their value</span>
</pre></div>


<div class="highlight"><pre><span></span>Tensor(&quot;Add:0&quot;, shape=(), dtype=int32)
</pre></div>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g1</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span> 
    <span class="k">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">eval</span><span class="p">())</span> <span class="c1"># evaluate their value</span>
</pre></div>


<div class="highlight"><pre><span></span>2
</pre></div>


<div class="highlight"><pre><span></span><span class="n">s1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sol</span><span class="p">))</span> <span class="c1"># another way of evaluating value</span>
</pre></div>


<div class="highlight"><pre><span></span>2
</pre></div>


<p>é‚£å¦‚æœæˆ‘æƒ³ä½¿ç”¨placeholderä¾†åšåˆ°x+yå‘¢ï¼Ÿ</p>
<div class="highlight"><pre><span></span><span class="n">g2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">g2</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># add x and y</span>

<span class="n">s2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">g2</span><span class="p">)</span>

<span class="c1"># if x = 2 and y = 3</span>
<span class="k">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="mi">3</span><span class="p">}))</span> 
</pre></div>


<div class="highlight"><pre><span></span>5
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># if x = 5 and y = 7</span>
<span class="k">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span> 
</pre></div>


<div class="highlight"><pre><span></span>12
</pre></div>


<p>å› ç‚ºxå’Œyæ˜¯placeholderï¼Œæ‰€ä»¥å¿…é ˆä½¿ç”¨<code>feed_dict</code>ä¾†é¤µå…¥ç›¸é—œè³‡è¨Šï¼Œå¦å‰‡æœƒå ±éŒ¯ã€‚</p>
<h3>ç¬¬ä¸€å€‹Tensorflow Model</h3>
<p>æœ‰äº†ä»¥ä¸Šçš„èªè­˜æˆ‘å€‘å°±å¯ä»¥ä¾†å»ºç«‹æˆ‘å€‘ç¬¬ä¸€å€‹Modelã€‚</p>
<p>ä»¥ä¸‹æˆ‘æœƒä½¿ç”¨ç‰©ä»¶å°å‘çš„å¯«æ³•ï¼Œè®“ç¨‹å¼ç¢¼æ›´æœ‰æ¢ç†ã€‚</p>
<p>Machine Learningåœ¨æ“ä½œä¸Šå¯ä»¥æ•´ç†æˆä¸‰å€‹å¤§æ­¥é©Ÿï¼šå»ºæ§‹(Building)ã€è¨“ç·´(Fitting)å’Œæ¨è«–(Inference)ï¼Œæ‰€ä»¥æˆ‘å€‘å°‡æœƒä½¿ç”¨é€™ä¸‰å¤§æ­¥é©Ÿä¾†å»ºè£½æˆ‘å€‘çš„Modelã€‚</p>
<p>åœ¨<code>SimpleLogisticClassification</code>è£¡é ­ï¼Œã€Œå»ºæ§‹ã€çš„å‹•ä½œåœ¨<code>__init__</code>ä¸­æœƒé€²è¡Œï¼Œç”±<code>build</code>å‡½å¼ä¾†å»ºç«‹Graphï¼Œå…¶ä¸­æˆ‘å°‡Neurel Networkçš„çµæ§‹åˆ†é›¢å­˜æ–¼<code>structure</code>è£¡ã€‚ã€Œè¨“ç·´ã€çš„å‹•ä½œåœ¨<code>fit</code>ä¸­é€²è¡Œï¼Œé€™è£¡æ¡ç”¨å‚³çµ±çš„Gradient Descentçš„æ–¹æ³•ï¼Œå°‡æ‰€æœ‰Dataå…¨éƒ¨è€ƒæ…®é€²å»æœ€ä½³åŒ–ï¼Œæœªä¾†æœƒå†ä»‹ç´¹Batch Gradient Descentã€‚æœ€å¾Œï¼Œã€Œæ¨è«–ã€çš„éƒ¨åˆ†åœ¨<code>predict</code>å’Œ<code>evaluate</code>ä¸­é€²è¡Œã€‚</p>
<p><code>SimpleLogisticClassification</code>å°‡æœƒå»ºæ§‹ä¸€å€‹åªæœ‰ä¸€å±¤çš„Neurel Networkï¼Œä¹Ÿå°±æ˜¯èªªæ²’æœ‰Hidden Layerï¼Œç•«å€‹åœ–ã€‚</p>
<p><img alt="Simple Logistic Classification" src="https://raw.githubusercontent.com/GitYCC/Tensorflow_Tutorial/master/img/TensorflowTutorial.002.jpeg"></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleLogisticClassification</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_features</span><span class="p">,</span><span class="n">n_labels</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_labels</span> <span class="o">=</span> <span class="n">n_labels</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">biases</span>  <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span> <span class="c1"># initialize new graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span> <span class="c1"># building graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span> <span class="c1"># create session by the graph     </span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">learning_rate</span><span class="p">):</span>
        <span class="c1"># Building Graph</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">as_default</span><span class="p">():</span>
            <span class="c1">### Input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span>   <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span>  <span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_labels</span><span class="p">))</span>

            <span class="c1">### Optimalization</span>
            <span class="c1"># build neurel network structure and get their predictions and loss</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_features</span><span class="p">,</span>
                                                        <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">)</span>
            <span class="c1"># define training operation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">)</span>

            <span class="c1">### Prediction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_features</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_labels</span>   <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span>  <span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_labels</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_y_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">new_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_features</span><span class="p">,</span>
                                                       <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_labels</span><span class="p">,)</span>

            <span class="c1">### Initialization</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
        <span class="c1"># build neurel network structure and return their predictions and loss</span>
        <span class="c1">### Variable</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">biases</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fc1&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">truncated_normal</span><span class="p">(</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_labels</span><span class="p">)</span> <span class="p">)),</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">biases</span>  <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fc1&#39;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_labels</span><span class="p">)</span> <span class="p">)),</span>
            <span class="p">}</span> 

        <span class="c1">### Structure   </span>
        <span class="c1"># one fully connected layer</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDenseLayer</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="s1">&#39;fc1&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">biases</span><span class="p">[</span><span class="s1">&#39;fc1&#39;</span><span class="p">])</span>

        <span class="c1"># predictions</span>
        <span class="n">y_</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>

        <span class="c1"># loss: softmax cross entropy</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
                 <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax_cross_entropy_with_logits</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">logits</span><span class="o">=</span><span class="n">logits</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">y_</span><span class="p">,</span><span class="n">loss</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getDenseLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_layer</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">activation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># fully connected layer</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">input_layer</span><span class="p">,</span><span class="n">weight</span><span class="p">),</span><span class="n">bias</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">activation</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">activation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">validation_data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">test_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_op</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Epoch </span><span class="si">%2d</span><span class="s2">/</span><span class="si">%2d</span><span class="s2">: &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">epochs</span><span class="p">))</span>

            <span class="c1"># fully gradient descent</span>
            <span class="n">feed_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">train_features</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_labels</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_op</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="n">feed_dict</span><span class="p">)</span>

            <span class="c1"># evaluate at the end of this epoch</span>
            <span class="n">y_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">train_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="n">train_acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">y_</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot; loss = </span><span class="si">%8.4f</span><span class="s2">, acc = </span><span class="si">%3.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">train_loss</span><span class="p">,</span> <span class="n">train_acc</span><span class="o">*</span><span class="mi">100</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">validation_data</span><span class="p">:</span>
                <span class="n">val_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">val_acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;, val_loss = </span><span class="si">%8.4f</span><span class="s2">, val_acc = </span><span class="si">%3.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">val_loss</span><span class="p">,</span> <span class="n">val_acc</span><span class="o">*</span><span class="mi">100</span> <span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">test_data</span><span class="p">:</span>
            <span class="n">test_acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">test_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;test_acc = </span><span class="si">%3.2f%%</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test_acc</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_y_</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_features</span><span class="p">:</span> <span class="n">X</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_loss</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">new_features</span><span class="p">:</span> <span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_labels</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_check_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ndarray</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">ndarray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">ndarray</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SimpleLogisticClassification</span><span class="p">(</span><span class="n">n_features</span><span class="o">=</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span>
                                     <span class="n">n_labels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                     <span class="n">learning_rate</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_data</span><span class="o">.</span><span class="n">images</span><span class="p">,</span>
          <span class="n">y</span><span class="o">=</span><span class="n">train_data</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">valid_data</span><span class="o">.</span><span class="n">images</span><span class="p">,</span><span class="n">valid_data</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span>
          <span class="n">test_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">images</span><span class="p">,</span><span class="n">test_data</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Epoch  1/10: 
 loss =   9.4080, acc = 12.45%, val_loss =   9.3869, val_acc = 12.78%
Epoch  2/10: 
 loss =   8.2898, acc = 14.57%, val_loss =   8.2863, val_acc = 14.66%
Epoch  3/10: 
 loss =   7.4517, acc = 16.82%, val_loss =   7.4578, val_acc = 16.74%
Epoch  4/10: 
 loss =   6.8298, acc = 19.23%, val_loss =   6.8352, val_acc = 19.10%
Epoch  5/10: 
 loss =   6.3458, acc = 21.83%, val_loss =   6.3448, val_acc = 21.12%
Epoch  6/10: 
 loss =   5.9372, acc = 24.16%, val_loss =   5.9287, val_acc = 23.64%
Epoch  7/10: 
 loss =   5.5760, acc = 26.53%, val_loss =   5.5604, val_acc = 25.98%
Epoch  8/10: 
 loss =   5.2527, acc = 28.88%, val_loss =   5.2306, val_acc = 28.42%
Epoch  9/10: 
 loss =   4.9624, acc = 31.05%, val_loss =   4.9344, val_acc = 30.54%
Epoch 10/10: 
 loss =   4.7012, acc = 33.06%, val_loss =   4.6681, val_acc = 32.52%
test_acc = 32.77%
</pre></div>


        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="./archives.html">Archives</a></li>
                            <li><a href="./tags.html">Tags</a></li>
                            <li><a href="YCNote/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Contact Me</div>
                        <ul class="list-unstyled">
                            <li><a href="./about-me.html" target="_blank">About Me</a></li>
                            <li><a href="https://github.com/GitYCC" target="_blank">Github</a></li>
                            <li><a href="mailto:ycc.tw.email@gmail.com" target="_blank">Email</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; YC Note 2018</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>